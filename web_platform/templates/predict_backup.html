<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Demo - CardioPredict AI Risk Prediction</title>

    <!-- Meta tags -->
    <meta
      name="description"
      content="Interactive demo of CardioPredict's AI-powered cardiovascular risk prediction system for space medicine and Earth analog applications."
    />
    <meta
      name="keywords"
      content="cardiovascular risk demo, AI prediction, biomarker analysis, space medicine, interactive tool"
    />
    <meta name="author" content="CardioPredict Research Team" />

    <!-- Professional fonts and icons -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- CSS Framework and Custom Styles -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />

    <style>
      .demo-container {
        padding-top: calc(var(--navbar-height) + 2rem);
        min-height: 100vh;
      }

      .biomarker-input {
        margin-bottom: 1rem;
      }

      .biomarker-label {
        font-weight: 500;
        color: var(--primary-blue);
        margin-bottom: 0.5rem;
      }

      .biomarker-info {
        font-size: 0.85rem;
        color: var(--medium-gray);
        margin-bottom: 0.5rem;
      }

      .risk-score-display {
        text-align: center;
        padding: 2rem;
        background: linear-gradient(135deg, var(--light-blue), var(--white));
        border-radius: var(--border-radius);
        border: 2px solid var(--accent-blue);
      }

      .risk-score-circle {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 0 auto 1rem;
        font-weight: 700;
        color: white;
        position: relative;
      }

      .risk-score-value {
        font-size: 2rem;
        line-height: 1;
      }

      .risk-score-label {
        font-size: 0.8rem;
        opacity: 0.9;
      }

      .risk-low {
        background: linear-gradient(135deg, var(--success-green), #20c997);
      }

      .risk-medium, .risk-moderate {
        background: linear-gradient(135deg, var(--warning-orange), #ffc107);
      }

      .risk-high {
        background: linear-gradient(135deg, var(--cardio-red), #dc3545);
      }

      .prediction-card {
        display: none;
        animation: fadeInUp 0.6s ease-out;
      }

      .biomarker-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1rem;
      }

      .sample-data-btn {
        background: var(--accent-blue);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: var(--border-radius);
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .sample-data-btn:hover {
        background: var(--primary-blue);
        transform: translateY(-2px);
      }

      .environment-selector {
        background: var(--off-white);
        padding: 1rem;
        border-radius: var(--border-radius);
        margin-bottom: 2rem;
      }

      .environment-option {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background: white;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
      }

      .environment-option:hover {
        border-color: var(--accent-blue);
        transform: translateY(-2px);
      }

      .environment-option.active {
        border-color: var(--primary-blue);
        background: var(--light-blue);
      }

      .environment-option input[type="radio"] {
        margin-right: 0.75rem;
      }

      .environment-icon {
        font-size: 1.5rem;
        margin-right: 1rem;
        width: 40px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
      <div class="container">
        <a
          class="navbar-brand d-flex align-items-center"
          href="{{ url_for('homepage') }}"
        >
          <i class="fas fa-heartbeat me-2"></i>
          <span class="brand-text">CardioPredict</span>
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('homepage') }}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('research') }}">Research</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('predict') }}"
                >Predict</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Demo Container -->
    <div class="demo-container">
      <div class="container">
        <!-- Demo Header -->
        <div class="row mb-4">
          <div class="col-lg-8 mx-auto text-center">
            <div class="badge bg-primary mb-3 px-3 py-2">
              <i class="fas fa-rocket me-2"></i>Interactive Demo
            </div>
            <h1>Cardiovascular Risk Prediction</h1>
            <p class="lead">
              Experience our AI-powered system for predicting cardiovascular
              risk in microgravity and Earth analog environments. Enter
              biomarker values or use sample data to see real-time predictions.
            </p>
            <div class="mb-3">
              <span class="badge bg-success me-2">
                <i class="fas fa-check me-1"></i>Publication Ready (RÂ² = 0.998)
              </span>
              <span class="badge bg-primary me-2">
                <i class="fas fa-rocket me-1"></i>Space Medicine Validated
              </span>
              <span class="badge bg-info">
                <i class="fas fa-shield-alt me-1"></i>Clinical Grade
              </span>
            </div>
          </div>
        </div>

        <!-- Environment Selection -->
        <div class="row mb-4">
          <div class="col-lg-8 mx-auto">
            <div class="environment-selector">
              <h5 class="mb-3">
                <i class="fas fa-globe me-2"></i>Select Environment
              </h5>
              <div class="row">
                <div class="col-md-4">
                  <div
                    class="environment-option active"
                    data-environment="space"
                  >
                    <input
                      type="radio"
                      name="environment"
                      value="space"
                      checked
                    />
                    <div class="environment-icon">
                      <i class="fas fa-rocket text-primary"></i>
                    </div>
                    <div>
                      <strong>Space Mission</strong>
                      <small class="d-block text-muted"
                        >Microgravity environment</small
                      >
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="environment-option" data-environment="bedrest">
                    <input type="radio" name="environment" value="bedrest" />
                    <div class="environment-icon">
                      <i class="fas fa-bed text-warning"></i>
                    </div>
                    <div>
                      <strong>Bedrest Study</strong>
                      <small class="d-block text-muted"
                        >Earth analog simulation</small
                      >
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="environment-option" data-environment="hospital">
                    <input type="radio" name="environment" value="hospital" />
                    <div class="environment-icon">
                      <i class="fas fa-hospital text-success"></i>
                    </div>
                    <div>
                      <strong>Hospital Patient</strong>
                      <small class="d-block text-muted"
                        >Clinical application</small
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Demo Interface -->
        <div class="row">
          <!-- Biomarker Input Panel -->
          <div class="col-lg-8">
            <div class="card shadow-custom">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                  <i class="fas fa-vial me-2"></i>Biomarker Input
                  <button
                    type="button"
                    class="btn btn-light btn-sm float-end sample-data-btn"
                    onclick="loadSampleData()"
                  >
                    <i class="fas fa-magic me-1"></i>Load Sample Data
                  </button>
                </h5>
              </div>
              <div class="card-body">
                <form id="predictionForm" method="POST" action="{{ url_for('make_prediction') }}">
                  <div class="biomarker-grid">
                    <!-- High-Impact Biomarkers -->
                    <div class="biomarker-input">
                      <label class="biomarker-label"
                        >C-Reactive Protein (CRP)</label
                      >
                      <div class="biomarker-info">
                        Inflammation marker (mg/L)
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="crp"
                        step="0.1"
                        min="0"
                        max="100"
                        placeholder="Enter CRP level"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="biomarker-input">
                      <label class="biomarker-label"
                        >Platelet Factor 4 (PF4)</label
                      >
                      <div class="biomarker-info">
                        Platelet activation marker (ng/mL)
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="pf4"
                        step="0.01"
                        min="0"
                        max="50"
                        placeholder="Enter PF4 level"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="biomarker-input">
                      <label class="biomarker-label">Fetuin A36</label>
                      <div class="biomarker-info">
                        Vascular calcification inhibitor (Î¼g/mL)
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="fetuin_a36"
                        step="0.1"
                        min="0"
                        max="500"
                        placeholder="Enter Fetuin A36 level"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="biomarker-input">
                      <label class="biomarker-label">Fibrinogen</label>
                      <div class="biomarker-info">
                        Coagulation factor (mg/dL)
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="fibrinogen"
                        step="1"
                        min="100"
                        max="800"
                        placeholder="Enter Fibrinogen level"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <!-- Clinical Standard Markers -->
                    <div class="biomarker-input">
                      <label class="biomarker-label">Troponin I</label>
                      <div class="biomarker-info">
                        Cardiac injury marker (ng/mL)
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="troponin_i"
                        step="0.001"
                        min="0"
                        max="10"
                        placeholder="Enter Troponin I level"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="biomarker-input">
                      <label class="biomarker-label"
                        >B-type Natriuretic Peptide (BNP)</label
                      >
                      <div class="biomarker-info">
                        Heart failure marker (pg/mL)
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="bnp"
                        step="1"
                        min="0"
                        max="5000"
                        placeholder="Enter BNP level"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <!-- Additional Key Markers -->
                    <div class="biomarker-input">
                      <label class="biomarker-label">LDL Cholesterol</label>
                      <div class="biomarker-info">
                        Low-density lipoprotein (mg/dL)
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="ldl_cholesterol"
                        step="1"
                        min="50"
                        max="300"
                        placeholder="Enter LDL level"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="biomarker-input">
                      <label class="biomarker-label">HDL Cholesterol</label>
                      <div class="biomarker-info">
                        High-density lipoprotein (mg/dL)
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="hdl_cholesterol"
                        step="1"
                        min="20"
                        max="150"
                        placeholder="Enter HDL level"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="biomarker-input">
                      <label class="biomarker-label"
                        >Systolic Blood Pressure</label
                      >
                      <div class="biomarker-info">Systolic pressure (mmHg)</div>
                      <input
                        type="number"
                        class="form-control"
                        name="systolic_bp"
                        step="1"
                        min="80"
                        max="200"
                        placeholder="Enter systolic BP"
                      />
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="biomarker-input">
                      <label class="biomarker-label"
                        >Mission Duration (Days)</label
                      >
                      <div class="biomarker-info">
                        Days in microgravity/bedrest
                      </div>
                      <input
                        type="number"
                        class="form-control"
                        name="mission_duration"
                        step="1"
                        min="1"
                        max="1000"
                        placeholder="Enter duration"
                      />
                      <div class="invalid-feedback"></div>
                    </div>
                  </div>

                  <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                      <i class="fas fa-brain me-2"></i>Predict Cardiovascular
                      Risk
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Results Panel -->
          <div class="col-lg-4">
            <div class="card shadow-custom">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                  <i class="fas fa-chart-line me-2"></i>Risk Assessment
                </h5>
              </div>
              <div class="card-body">
                {% if prediction %}
                <!-- Prediction Results -->
                <div id="prediction-results" class="prediction-card" style="display: block;">
                  <div class="risk-score-display">
                    <div
                      id="risk-score-circle"
                      class="risk-score-circle risk-{{ prediction.risk_category.lower() }}"
                    >
                      <span id="risk-score-value" class="risk-score-value"
                        >{{ "%.1f"|format(prediction.cv_risk_score) }}</span
                      >
                      <span class="risk-score-label">Risk Score</span>
                    </div>
                    <h6 id="risk-level" class="mb-0">{{ prediction.risk_category }} Risk</h6>
                    <p id="risk-description" class="text-muted small mb-3">
                      {% if prediction.risk_category == 'Low' %}
                        Cardiovascular parameters within normal ranges
                      {% elif prediction.risk_category == 'Moderate' %}
                        Some elevated biomarkers require monitoring
                      {% else %}
                        Multiple elevated cardiovascular risk factors
                      {% endif %}
                    </p>

                    <div class="mb-3">
                      <label class="form-label small">Model Confidence</label>
                      <div class="progress">
                        <div
                          id="confidence-bar"
                          class="progress-bar bg-info"
                          style="width: {{ prediction.confidence * 100 }}%"
                        >
                          <span id="confidence-value">{{ "%.1f"|format(prediction.confidence * 100) }}%</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Detailed Analysis -->
                  <div class="mt-4">
                    <h6>
                      <i class="fas fa-microscope me-2"></i>Analysis Details
                    </h6>
                    <div id="analysis-details">
                      <div class="mb-2">
                        <span class="fw-medium">Risk Category:</span>
                        <span class="badge bg-{{ prediction.risk_color }} ms-2">{{ prediction.risk_category }}</span>
                      </div>
                      <div class="mb-2">
                        <span class="fw-medium">Assessment Time:</span>
                        <span class="text-muted ms-2">{{ prediction.timestamp }}</span>
                      </div>
                    </div>
                  </div>

                  <!-- Recommendations -->
                  <div class="mt-4">
                    <h6>
                      <i class="fas fa-lightbulb me-2"></i>Recommendations
                    </h6>
                    <div id="recommendations">
                      {% for rec in prediction.recommendations %}
                      <div class="mb-1">
                        <i class="fas fa-check-circle text-success me-2"></i>{{ rec }}
                      </div>
                      {% endfor %}
                    </div>
                  </div>

                  <!-- Model Information -->
                  <div class="mt-4">
                    <small class="text-muted">
                      <i class="fas fa-info-circle me-1"></i>
                      Prediction based on
                      <span id="model-used">Ridge Regression Model</span> (RÂ²
                      = <span id="model-accuracy">0.998</span>)
                    </small>
                  </div>
                </div>
                {% else %}
                <!-- Default State -->
                <div id="default-state" class="text-center py-4">
                  <i
                    class="fas fa-heartbeat text-muted mb-3"
                    style="font-size: 3rem"
                  ></i>
                  <h6 class="text-muted">
                    Enter biomarker values to get started
                  </h6>
                  <p class="text-muted small">
                    Our AI model will analyze the biomarker profile and provide
                    a comprehensive cardiovascular risk assessment.
                  </p>
                </div>
                {% endif %}
              </div>
            </div>

            <!-- Model Performance Card -->
            <div class="card shadow-custom mt-4">
              <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                  <i class="fas fa-chart-bar me-2"></i>Model Performance
                </h6>
              </div>
              <div class="card-body">
                <div class="row text-center">
                  <div class="col-6">
                    <div class="fw-bold text-success">99.8%</div>
                    <small class="text-muted">Accuracy</small>
                  </div>
                  <div class="col-6">
                    <div class="fw-bold text-primary">0.998</div>
                    <small class="text-muted">RÂ² Score</small>
                  </div>
                </div>
                <hr>
                <small class="text-muted">
                  <i class="fas fa-rocket me-1"></i>
                  Trained on NASA Inspiration4 mission data and validated on Earth analog studies.
                </small>
              </div>
            </div>
          </div>
        </div>

        <!-- Technical Information -->
        <div class="row mt-5">
          <div class="col-12">
            <div class="card shadow-custom">
              <div class="card-header">
                <h5 class="mb-0">
                  <i class="fas fa-info-circle me-2"></i>About This Prediction System
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h6>Model Details</h6>
                    <ul class="list-unstyled">
                      <li><i class="fas fa-check text-success me-2"></i>Ridge Regression Algorithm</li>
                      <li><i class="fas fa-check text-success me-2"></i>99.8% Prediction Accuracy</li>
                      <li><i class="fas fa-check text-success me-2"></i>RÂ² Score: 0.998</li>
                      <li><i class="fas fa-check text-success me-2"></i>10 Key Biomarkers</li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <h6>Training Data</h6>
                    <ul class="list-unstyled">
                      <li><i class="fas fa-rocket text-primary me-2"></i>NASA SpaceX Inspiration4 Mission</li>
                      <li><i class="fas fa-bed text-warning me-2"></i>Earth Analog Bedrest Studies</li>
                      <li><i class="fas fa-hospital text-success me-2"></i>Clinical Validation Cohorts</li>
                      <li><i class="fas fa-users text-info me-2"></i>Multi-environment Dataset</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-dark text-light py-4 mt-5">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <p class="mb-0">
              <i class="fas fa-heartbeat me-2"></i>
              <strong>CardioPredict</strong> - AI-Powered Cardiovascular Risk Assessment
            </p>
          </div>
          <div class="col-md-6 text-md-end">
            <p class="mb-0">
              <i class="fas fa-flask me-2"></i>Publication-Ready Research Platform
            </p>
          </div>
        </div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <script>
      // Enhanced demo functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Environment option selection
        const environmentOptions = document.querySelectorAll(
          ".environment-option"
        );
        environmentOptions.forEach((option) => {
          option.addEventListener("click", function () {
            // Update active state
            environmentOptions.forEach((opt) => opt.classList.remove("active"));
            this.classList.add("active");

            // Update radio button
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;

            // Update form context
            updateEnvironmentContext(radio.value);
          });
        });

        // Form submission handling with validation
        const form = document.getElementById("predictionForm");
        if (form) {
          form.addEventListener("submit", function (e) {
            if (!validateForm()) {
              e.preventDefault();
              return false;
            }
          });
        }
      });

      function updateEnvironmentContext(environment) {
        // Update sample data and context based on selected environment
        console.log("Environment selected:", environment);
      }

      function validateForm() {
        const inputs = document.querySelectorAll('#predictionForm input[type="number"]');
        let isValid = true;
        let hasValues = false;

        inputs.forEach(input => {
          input.classList.remove('is-invalid', 'is-valid');
          if (input.value && input.value.trim() !== '') {
            hasValues = true;
            if (parseFloat(input.value) >= parseFloat(input.min) && parseFloat(input.value) <= parseFloat(input.max)) {
              input.classList.add('is-valid');
            } else {
              input.classList.add('is-invalid');
              isValid = false;
            }
          }
        });

        if (!hasValues) {
          alert('Please enter at least one biomarker value to make a prediction.');
          return false;
        }

        return isValid;
      }

      function loadSampleData() {
        const environment = document.querySelector(
          'input[name="environment"]:checked'
        ).value;
        const sampleData = getSampleDataForEnvironment(environment);

        // Populate form fields with sample data
        Object.keys(sampleData).forEach((key) => {
          const input = document.querySelector(`input[name="${key}"]`);
          if (input) {
            input.value = sampleData[key];
            input.classList.add("is-valid");
          }
        });

        // Show notification
        showNotification(
          `Sample ${environment} data loaded successfully!`,
          "success"
        );
      }

      function getSampleDataForEnvironment(environment) {
        const sampleData = {
          space: {
            crp: 2.1,
            pf4: 12.5,
            fetuin_a36: 285.0,
            fibrinogen: 320,
            troponin_i: 0.012,
            bnp: 45,
            ldl_cholesterol: 105,
            hdl_cholesterol: 52,
            systolic_bp: 118,
            mission_duration: 14,
          },
          bedrest: {
            crp: 3.8,
            pf4: 18.2,
            fetuin_a36: 245.0,
            fibrinogen: 380,
            troponin_i: 0.008,
            bnp: 62,
            ldl_cholesterol: 125,
            hdl_cholesterol: 45,
            systolic_bp: 125,
            mission_duration: 60,
          },
          hospital: {
            crp: 5.2,
            pf4: 22.1,
            fetuin_a36: 210.0,
            fibrinogen: 420,
            troponin_i: 0.025,
            bnp: 95,
            ldl_cholesterol: 145,
            hdl_cholesterol: 38,
            systolic_bp: 135,
            mission_duration: 21,
          },
        };

        return sampleData[environment] || sampleData.space;
      }

      function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 100px; right: 20px; z-index: 9999; max-width: 300px;';
        notification.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        document.body.appendChild(notification);

        // Auto remove after 3 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }
    </script>
  </body>
</html>
              </div>
            </div>

            <div class="col-md-8 text-start">
              <h5 class="fw-bold mb-3">Clinical Recommendations</h5>
              <div class="recommendations">
                {% for recommendation in prediction.recommendations %}
                <div class="recommendation-item">
                  <i
                    class="fas fa-{{ 'exclamation-triangle' if loop.index <= 2 else 'info-circle' }} me-2 text-{{ prediction.risk_color }}"
                  ></i>
                  {{ recommendation }}
                </div>
                {% endfor %}
              </div>

              <div class="mt-3 text-muted">
                <small>
                  <i class="fas fa-clock me-1"></i>
                  Generated: {{ prediction.timestamp }}
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Prediction Form -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-user-md me-2"></i>
            Patient Biomarker Input {% if prediction %}
            <span class="badge bg-success ms-2">Prediction Complete</span>
            {% endif %}
          </h5>
        </div>
        <div class="card-body">
          {% if error %}
          <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            {{ error }}
          </div>
          {% endif %}

          <form
            method="POST"
            id="predictForm"
            class="needs-validation"
            novalidate
          >
            <div class="feature-grid">
              {% for feature in features %}
              <div class="mb-3">
                <label for="{{ feature }}" class="form-label">
                  {{ feature.replace('_', ' ').title() }}
                  <i
                    class="fas fa-question-circle text-muted ms-1"
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="Enter measured biomarker value"
                  ></i>
                </label>
                <div class="input-group">
                  {% if feature.endswith('_zscore') %}
                  <span class="input-group-text">Z</span>
                  {% elif 'mg_dl' in feature %}
                  <span class="input-group-text">mg/dL</span>
                  {% elif feature == 'CRP' %}
                  <span class="input-group-text">ng/mL</span>
                  {% elif feature in ['PF4', 'SAP', 'Haptoglobin'] %}
                  <span class="input-group-text">pg/mL</span>
                  {% else %}
                  <span class="input-group-text">Units</span>
                  {% endif %}

                  <input
                    type="number"
                    class="form-control biomarker-input"
                    id="{{ feature }}"
                    name="{{ feature }}"
                    step="{{ '0.1' if '_zscore' in feature or feature == 'Fibrinogen_mg_dl' else '1' }}"
                    min="0"
                    value="{{ form_data.get(feature, '') if form_data else '' }}"
                    placeholder="Enter {{ feature.replace('_', ' ').lower() }} value"
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="Enter measured biomarker value"
                  />
                </div>
                <div class="form-text">
                  Normal ranges vary by biomarker - consult reference values
                </div>
              </div>
              {% endfor %}
            </div>

            <div class="d-flex justify-content-between align-items-center mt-4">
              <div>
                <button type="reset" class="btn btn-outline-secondary me-2">
                  <i class="fas fa-undo me-2"></i>
                  Reset Form
                </button>
                <button
                  type="button"
                  class="btn btn-outline-info"
                  onclick="fillSampleData()"
                >
                  <i class="fas fa-vial me-2"></i>
                  Load Sample Data
                </button>
              </div>

              <div>
                <button type="submit" class="btn btn-primary btn-lg px-4">
                  <i class="fas fa-brain me-2"></i>
                  Calculate Risk
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Model Information -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card bg-light">
        <div class="card-body">
          <h6 class="fw-bold mb-3">
            <i class="fas fa-info-circle me-2"></i>
            Model Information
          </h6>
          <div class="row g-3">
            <div class="col-md-3">
              <div class="text-center">
                <div class="h5 text-primary fw-bold">99.8%</div>
                <small class="text-muted">Model Accuracy (RÂ²)</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center">
                <div class="h5 text-success fw-bold">{{ features|length }}</div>
                <small class="text-muted">Key Biomarkers</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center">
                <div class="h5 text-info fw-bold">28</div>
                <small class="text-muted">Training Samples</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center">
                <div class="h5 text-warning fw-bold">Cross-Val</div>
                <small class="text-muted">Validation Method</small>
              </div>
            </div>
          </div>

          <div class="mt-3">
            <small class="text-muted">
              <i class="fas fa-shield-alt me-1"></i>
              This model has been validated on NASA OSDR datasets and bedrest
              studies. Results should be interpreted by qualified medical
              personnel.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<script>
  // Feature descriptions for tooltips
  const featureDescriptions = {
    CRP: "C-Reactive Protein - Inflammatory marker (normal: <3,000 ng/mL)",
    PF4: "Platelet Factor 4 - Thrombotic risk marker (normal: 8,000-15,000 pg/mL)",
    SAP: "Serum Amyloid P - Acute phase protein (normal: 20,000-50,000 pg/mL)",
    Fibrinogen_mg_dl: "Fibrinogen - Clotting factor (normal: 200-400 mg/dL)",
    Haptoglobin:
      "Haptoglobin - Hemoglobin-binding protein (normal: 30,000-200,000 pg/mL)",
    AGP_Change_From_Baseline: "Alpha-1 Acid Glycoprotein change from baseline",
    PF4_Change_From_Baseline: "PF4 change from baseline values",
    CRP_zscore: "CRP Z-score (standardized value)",
    PF4_zscore: "PF4 Z-score (standardized value)",
    SAP_zscore: "SAP Z-score (standardized value)",
  };

  function get_feature_description(feature) {
    return featureDescriptions[feature] || "Enter measured biomarker value";
  }

  function get_normal_range(feature) {
    const ranges = {
      CRP: "Normal: <3,000 ng/mL",
      PF4: "Normal: 8,000-15,000 pg/mL",
      SAP: "Normal: 20,000-50,000 pg/mL",
      Fibrinogen_mg_dl: "Normal: 200-400 mg/dL",
      Haptoglobin: "Normal: 30,000-200,000 pg/mL",
      AGP_Change_From_Baseline: "Change from baseline (%)",
      PF4_Change_From_Baseline: "Change from baseline (%)",
      CRP_zscore: "Z-score: typically -2 to +2",
      PF4_zscore: "Z-score: typically -2 to +2",
      SAP_zscore: "Z-score: typically -2 to +2",
    };
    return ranges[feature] || "Consult reference ranges";
  }

  function fillSampleData() {
    // Sample data representing a moderate risk patient
    const sampleValues = {
      CRP: 15000000,
      PF4: 12000,
      SAP: 35000,
      Fibrinogen_mg_dl: 350,
      Haptoglobin: 85000,
      AGP_Change_From_Baseline: 15,
      PF4_Change_From_Baseline: 25,
      CRP_zscore: 1.2,
      PF4_zscore: 0.8,
      SAP_zscore: 0.5,
    };

    Object.entries(sampleValues).forEach(([feature, value]) => {
      const input = document.getElementById(feature);
      if (input) {
        input.value = value;
        input.classList.add("is-valid");
      }
    });

    CardioPredict.showNotification(
      "Sample data loaded successfully!",
      "success"
    );
  }

  document.addEventListener("DOMContentLoaded", function () {
    // Enhanced form validation
    const form = document.getElementById("predictForm");
    const inputs = form.querySelectorAll('input[type="number"]');

    inputs.forEach((input) => {
      input.addEventListener("input", function () {
        validateBiomarkerInput(this);
      });
    });

    function validateBiomarkerInput(input) {
      const value = parseFloat(input.value);
      const feature = input.id;

      input.classList.remove("is-valid", "is-invalid");

      if (isNaN(value) || value < 0) {
        if (input.value !== "") {
          input.classList.add("is-invalid");
        }
        return;
      }

      // Feature-specific validation
      let isValid = true;

      if (feature.includes("zscore")) {
        isValid = value >= -5 && value <= 5;
      } else if (feature === "CRP") {
        isValid = value <= 50000000; // Reasonable upper limit
      } else if (feature === "Fibrinogen_mg_dl") {
        isValid = value <= 1000;
      }

      if (isValid) {
        input.classList.add("is-valid");
      } else {
        input.classList.add("is-invalid");
      }
    }

    // Form submission handling
    form.addEventListener("submit", function (e) {
      const submitBtn = this.querySelector('button[type="submit"]');

      if (this.checkValidity()) {
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin me-2"></i>Calculating...';
        submitBtn.disabled = true;
      } else {
        e.preventDefault();
        e.stopPropagation();
        CardioPredict.showNotification(
          "Please check your input values",
          "warning"
        );
      }

      this.classList.add("was-validated");
    });
  });

  // Initialize tooltips with proper descriptions
  document.addEventListener("DOMContentLoaded", function () {
    // Update all tooltip descriptions
    document
      .querySelectorAll('[data-bs-toggle="tooltip"]')
      .forEach((tooltip) => {
        const feature = tooltip.closest(".mb-3").querySelector("input").id;
        if (feature && featureDescriptions[feature]) {
          tooltip.setAttribute("title", featureDescriptions[feature]);
        }
      });
  });
</script>
{% endblock %}
